# AppsFlyer Pull API Documentation

## Authorization

**Preferred Method: API V2 Token (Bearer Token)**

AppsFlyer Pull API uses V2 token-based authentication. The API token must be obtained by an admin from the AppsFlyer dashboard.

### Getting the API Token
1. Navigate to **Integration > API Access** in the AppsFlyer dashboard
2. An admin must retrieve the V2.0 token from the tokens page
3. By default, an API token is generated for each new account

### Using the Token
The API token can be used in two ways:

**Method 1: Authorization Header (Recommended)**
```bash
Authorization: Bearer YOUR_API_TOKEN
```

**Method 2: Query Parameter**
```bash
?api_token=YOUR_API_TOKEN
```

### Security Best Practices
- Only admins can view and manage tokens
- Replace tokens every 180 days (recommended)
- API V2 tokens are JWT-based (API V1 tokens are deprecated)

### Example Authentication Request
```bash
curl -X GET \
  "https://hq1.appsflyer.com/api/raw-data/export/app/com.example.app/installs_report/v5?from=2025-01-01&to=2025-01-02" \
  -H "Authorization: Bearer YOUR_API_TOKEN"
```

## Object List

AppsFlyer Pull API provides access to raw data reports organized into two main categories: **User Journey Reports** and **Feature Reports**.

### Retrieving the Object List

The list of available report types is **static** and predefined by AppsFlyer. There is no API endpoint to dynamically retrieve available reports. The complete list is documented below.

### User Journey Reports

These reports trace the user journey and engagement with the app (click → install → in-app event → uninstall).

#### Ad Engagement Reports
- `clicks_report` - Non-organic ad clicks (real-time)
- `impressions_report` - Non-organic ad impressions (real-time)

#### User Acquisition Reports (Organic & Non-Organic)
- `installs_report` - Non-organic installs (real-time)
- `organic_installs_report` - Organic installs (real-time)
- `in_app_events_report` - Non-organic in-app events (real-time)
- `organic_in_app_events_report` - Organic in-app events (real-time)
- `sessions_report` - Non-organic sessions (real-time)
- `organic_sessions_report` - Organic sessions (real-time)
- `uninstall_events_report` - Non-organic uninstalls (daily updates)
- `organic_uninstall_events_report` - Organic uninstalls (daily updates)
- `attributed_ad_revenue_report` - Non-organic ad revenue (real-time)
- `organic_ad_revenue_report` - Organic ad revenue (real-time)

#### Retargeting Reports (Non-Organic Only)
- `conversions_report` - Re-engagements and re-attributions (real-time)
- `retargeting_in_app_events_report` - Retargeting in-app events (real-time)
- `retargeting_sessions_report` - Retargeting sessions (real-time)
- `retargeting_ad_revenue_report` - Retargeting ad revenue (real-time)

### Feature Reports

These reports relate to specific AppsFlyer features.

#### Postback Reports
- `install_postbacks_report` - Install postbacks to ad networks (daily)
- `inapps_postbacks_report` - In-app event postbacks (daily)
- `conversions_postbacks_report` - Retargeting conversion postbacks (real-time)
- `retargeting_inapps_postbacks_report` - Retargeting in-app event postbacks (real-time)

#### Fraud & Protection Reports
- `blocked_installs_report` - Protect360 blocked installs (real-time)
- `blocked_install_postbacks_report` - Blocked install postbacks (real-time)
- `blocked_clicks_report` - Protect360 blocked clicks (daily)
- `post_attribution_installs_report` - Post-attribution fraud events (daily)
- `blocked_inapps_events_report` - Blocked in-app events (real-time)

**Note:** Some advanced reports (SKAdNetwork, Cross-Platform Engagements, Validation Rules) are exclusive to Data Locker and not available via Pull API.

## Object Schema

### Schema Retrieval Method

AppsFlyer Pull API returns data in **CSV format**. The schema (field structure) is **static** and documented in the AppsFlyer Raw Data Field Dictionary. There is no API to dynamically retrieve schemas.

### Common Schema Structure

All AppsFlyer raw data reports share a common base schema, though some fields may be populated with null/empty values depending on the report type and data collection context.

### Core Schema Fields

The following table shows the most important fields across all report types:

| Field Name | Data Type | Description | Available In |
|------------|-----------|-------------|--------------|
| `appsflyer_id` | String | Unique ID generated by SDK on first app launch | All reports |
| `event_time` | DateTime | Event occurrence timestamp (yyyy-mm-dd hh:mm:ss) | All reports |
| `event_name` | String | Attribution event type or in-app event name | Event reports |
| `event_type` | String | Attribution event classification | Attribution reports |
| `event_revenue` | String | Revenue value in event currency | Event reports |
| `event_revenue_currency` | String | Event revenue currency code (3-letter) | Event reports |
| `event_revenue_usd` | String | Revenue amount converted to USD | Event reports |
| `event_value` | String | Detailed event content from SDK | Event reports |
| `install_time` | DateTime | App installation timestamp | All reports |
| `attributed_touch_type` | String | Touch type (click/impression) | Attribution reports |
| `attributed_touch_time` | DateTime | Time of attributed touch | Attribution reports |
| `media_source` | String | Media source attributed to event | Non-organic reports |
| `campaign` | String | Campaign name | Non-organic reports |
| `af_channel` | String | Media source channel (YouTube, Instagram, etc.) | Non-organic reports |
| `af_ad` | String | Ad name from attribution links | Non-organic reports |
| `af_ad_id` | String/Int | Ad identifier | Non-organic reports |
| `af_adset` | String | Ad set name | Non-organic reports |
| `af_c_id` | String | Campaign identifier | Non-organic reports |
| `match_type` | String | Attribution method (SRN, probabilistic, deeplink) | Non-organic reports |
| `af_keywords` | String | Search keywords used by user | Non-organic reports |
| `af_cost_value` | String | Cost amount (4 decimal points) | Non-organic reports |
| `af_cost_currency` | String | Cost currency code (USD, EUR, etc.) | Non-organic reports |
| `advertising_id` | String | GAID (Android user-resettable ID) | Android reports |
| `idfa` | String | iOS user-resettable advertising identifier | iOS reports |
| `idfv` | String | iOS vendor ID | iOS reports |
| `android_id` | String | Permanent Android device identifier | Android reports |
| `imei` | String | Permanent device identifier | Device reports |
| `device_model` | String | Commercial model name (e.g., iPhone7) | All reports |
| `os_version` | String | Device OS version | All reports |
| `platform` | String | Device platform (android, ios, roku, etc.) | All reports |
| `language` | String | Device locale/language setting | All reports |
| `country_code` | String | ISO 3166 (alpha-2) country code | All reports |
| `city` | String | User location based on device IP | All reports |
| `region` | String | Geographic region from IP | All reports |
| `postal_code` | String | Postal code from device IP | All reports |
| `ip` | String | IPv4 or IPv6 address | All reports |
| `app_id` | String | Unique AppsFlyer app identifier | All reports |
| `app_name` | String | App name set by advertiser | All reports |
| `app_version` | String | App version | All reports |
| `bundle_id` | String | iOS bundle ID or Android package name | All reports |
| `carrier` | String | Mobile carrier name | All reports |
| `wifi` | Boolean | Connection type (true for WiFi) | All reports |
| `user_agent` | String | Device user agent string | All reports |

### In-App Purchase (IAP) & Subscription Fields

| Field Name | Data Type | Description |
|------------|-----------|-------------|
| `af_product_id` | String | Subscription product identifier |
| `af_purchase_date_ms` | Timestamp | Purchase date for in-app event |
| `af_transaction_id` | String | Transaction identifier (iOS) |
| `af_order_id` | String | Order identifier (Android) |
| `af_net_revenue` | String | Net revenue after adjustments |
| `af_store` | String | App store where product purchased |
| `af_currency` | String | IAP currency code |
| `af_price` | String | IAP price |
| `af_quantity` | String | Purchase quantity |

### Ad Revenue Fields

| Field Name | Data Type | Description |
|------------|-----------|-------------|
| `ad_revenue_ad_type` | String | Type of ad displayed |
| `mediation_network` | String | Ad mediation network reporting |
| `placement` | String | Where in app the ad displays |
| `impressions` | String | Number of times user saw ad |

### Fraud Prevention (Protect360) Fields

| Field Name | Data Type | Description |
|------------|-----------|-------------|
| `blocked_reason` | String | Reason install is blocked |
| `is_organic` | String | Indicates organic install association |
| `rejected_reason` | String | Rejection reason for validation |

### Additional Fields

AppsFlyer supports 100+ additional fields. Use the `additional_fields` query parameter to request non-default fields. See the Field Type Mapping section for complete details.

### Example CSV Response Structure

```csv
appsflyer_id,event_time,event_name,install_time,media_source,campaign,country_code,platform,app_id
1234567890123-4567890,2025-01-05 10:30:45,af_purchase,2025-01-04 08:15:30,facebook,summer_sale,US,android,com.example.app
```

## Get Object Primary Keys

### Primary Key Structure

AppsFlyer raw data reports use **`appsflyer_id`** as the primary identifier. However, the uniqueness constraint varies by report type.

### Primary Keys by Report Type

#### Install Reports
- **Primary Key:** `appsflyer_id`
- **Uniqueness:** Each `appsflyer_id` appears **once per install**
- **Notes:** AppsFlyer ID is generated on first app launch and persists throughout app lifecycle. A new ID is generated if app is deleted and reinstalled.

#### In-App Event Reports
- **Composite Primary Key:** `(appsflyer_id, event_time, event_name)`
- **Uniqueness:** Multiple events can occur for the same user
- **Notes:** Use combination of appsflyer_id, event_time, and event_name for deduplication

#### Uninstall Reports
- **Primary Key:** `appsflyer_id`
- **Uniqueness:** Each `appsflyer_id` appears once per uninstall
- **Notes:** Uninstalls are detected daily; data freshness is 24 hours

#### Session Reports
- **Composite Primary Key:** `(appsflyer_id, event_time)`
- **Uniqueness:** Multiple sessions per user
- **Notes:** Sessions have minimum time threshold between them

#### Retargeting Reports
- **Composite Primary Key:** `(appsflyer_id, event_time)`
- **Uniqueness:** Multiple retargeting events per user
- **Notes:** In retargeting scenarios, records with same appsflyer_id should be deduplicated by selecting latest event based on event_time

#### Postback Reports
- **Primary Key:** Varies by postback type
- **Uniqueness:** `appsflyer_id` combined with postback timestamp
- **Notes:** Postbacks are sent to ad networks; may contain duplicates

### Deduplication Strategy

When merging data from Pull API and Push API:
- Use `appsflyer_id` as the primary identifier
- For duplicate records, select the latest event based on `event_time`
- Consider `attributed_touch_time` for attribution deduplication

### Static Primary Key Configuration

The primary keys are **static** and determined by the report type. There is no API to dynamically retrieve primary key configurations.

## Object's Ingestion Type

### Ingestion Type by Report Type

AppsFlyer reports support different ingestion patterns based on data characteristics.

#### Snapshot (`snapshot`)

Reports that must be read in full with no incremental support:
- None (all AppsFlyer reports support incremental reading via date ranges)

#### Change Data Capture (`cdc`)

Reports that support incremental reads with upserts and/or deletes:
- `uninstall_events_report` - Tracks delete events (users uninstalling app)
- `organic_uninstall_events_report` - Tracks organic delete events

**Note:** Uninstall reports represent delete operations on install records. When a user uninstalls, the install record should be marked as deleted or removed.

#### Append-Only (`append`)

Reports that support incremental reads with only new data (no updates or deletes):
- `installs_report` - New installs only
- `organic_installs_report` - New organic installs only
- `in_app_events_report` - New events continuously added
- `organic_in_app_events_report` - New organic events
- `sessions_report` - New sessions
- `organic_sessions_report` - New organic sessions
- `clicks_report` - New clicks
- `impressions_report` - New impressions
- `conversions_report` - New retargeting conversions
- `retargeting_in_app_events_report` - New retargeting events
- `retargeting_sessions_report` - New retargeting sessions
- `attributed_ad_revenue_report` - New ad revenue events
- `organic_ad_revenue_report` - New organic ad revenue
- `retargeting_ad_revenue_report` - New retargeting ad revenue
- All postback reports - New postbacks
- All Protect360 fraud reports - New fraud events

### Data Freshness

- **Real-time reports:** Installs, in-app events, sessions, ad revenue, retargeting reports (continuously updated)
- **Daily reports:** Uninstalls, postbacks (updated daily at 00:00 UTC)

### Determining Ingestion Type

The ingestion type is **static** per report type. There is no API to dynamically determine ingestion type - it must be configured in the connector based on the table above.

## Read API for Data Retrieval

### Base Endpoint Structure

```
GET https://hq1.appsflyer.com/api/raw-data/export/app/{app-id}/{report-type}/v5
```

**Parameters:**
- `{app-id}`: Your application identifier (iOS bundle ID or Android package name)
- `{report-type}`: Report type from the Object List (e.g., `installs_report`, `in_app_events_report`)
- `/v5`: API version (current stable version)

### Required Query Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `from` | String | Yes | Report start date: `YYYY-MM-DD` or `YYYY-MM-DD HH:MM:SS` |
| `to` | String | Yes | Report end date: same format as `from` |

**Date Range Behavior:**
- The `from` parameter is **inclusive** (includes the specified time)
- The `to` parameter is **exclusive** (up to but not including the specified time)
- Activity date (when event occurred) is used, not ingestion date
- Maximum date range: No explicit limit, but large ranges should be split due to row limits

### Optional Query Parameters

| Parameter | Type | Description | Example |
|-----------|------|-------------|---------|
| `maximum_rows` | Integer | Limit result rows (default: 200,000; max: 1,000,000) | `maximum_rows=500000` |
| `media_source` | String | Filter by specific media source (single value only) | `media_source=facebook` |
| `category` | String | Media source category: `standard`, `facebook`, `twitter` | `category=facebook` |
| `event_name` | String | Filter in-app events (comma-separated list) | `event_name=af_purchase,af_subscribe` |
| `timezone` | String | App-specific timezone offset (URL-encoded) | `timezone=%2B10%3A00` (for UTC+10) |
| `currency` | String | Currency for revenue fields: `preferred` or `USD` (default) | `currency=preferred` |
| `geo` | String | Single country code filter (ISO 3166 alpha-2) | `geo=US` |
| `agency` | String | Filter by agency (single or comma-separated) | `agency=agency_name` |
| `additional_fields` | String | Request non-default fields (comma-separated) | `additional_fields=device_category,keyword_id` |
| `reattr` | Boolean | Include retargeting data: `true` or `false` | `reattr=true` |

**Special Notes:**
- For Facebook (Meta), use `media_source=facebook` (not "Meta")
- For Twitter (X), use `media_source=twitter` (not "X")
- Timezone format accounts for daylight saving time
- Only one `geo` country code per API call
- Use `category` parameter in conjunction with `media_source` for SRN sources

### Pagination Strategy

AppsFlyer does not use cursor-based or offset-based pagination. Instead, use **time-based splitting**:

#### Method 1: Check Row Count
1. Make request with date range
2. Check if returned rows equal `maximum_rows`
3. If equal, more data exists - split time range

#### Method 2: Time-Based Splitting
For large datasets, split the date range into smaller chunks:

```bash
# Split a day into two 12-hour requests
# Request 1: 00:00 to 12:00
from=2025-01-05&to=2025-01-05 12:00

# Request 2: 12:00 to 24:00 (or 00:00 next day)
from=2025-01-05 12:00&to=2025-01-06
```

**Best Practices:**
- Start with daily requests
- If row count hits limit, split into hourly requests
- For very high-volume apps, use hourly or sub-hourly splits
- Monitor the row count in responses to detect when splitting is needed

### Incremental Data Retrieval

#### Cursor Field
- **Primary cursor field:** `event_time` (event occurrence timestamp)
- **Fallback cursor:** `install_time` (for install-based reports)

#### Incremental Sync Strategy

**Initial Sync:**
1. Set `from` to `start_date` (e.g., 90 days ago)
2. Set `to` to current date
3. Fetch data day by day to respect row limits

**Subsequent Syncs:**
1. Use last successful `event_time` as new `from` value
2. Set `to` to current time
3. Apply **lookback window** (recommended: 3-7 days)

**Example Incremental Read:**
```bash
# First sync: Get last 7 days
from=2025-01-01&to=2025-01-08

# Next sync (1 day later): Use 3-day lookback
# Last sync ended at 2025-01-08, so start from 2025-01-05
from=2025-01-05&to=2025-01-09
```

#### Lookback Window Rationale
- **Data latency:** Some events arrive with delay (especially uninstalls)
- **Data corrections:** AppsFlyer may update historical records
- **Attribution window:** Late attributions may update older records
- **Recommended lookback:** 3-7 days for most reports; 1 day for real-time reports

#### Handling Deleted Records

**For Uninstall Reports:**
- Uninstall events represent users removing the app
- When processing uninstalls, mark corresponding install records as deleted
- Use `appsflyer_id` to match uninstall to original install
- Uninstalls are detected daily, not real-time

**For Other Reports:**
- AppsFlyer does not provide delete events for most report types
- No separate API endpoint for deletions
- Deleted/corrected records are not explicitly marked
- Use lookback window to catch any corrections/updates

### Example API Requests

#### Example 1: Basic Install Report
```bash
curl -X GET \
  "https://hq1.appsflyer.com/api/raw-data/export/app/com.example.app/installs_report/v5?from=2025-01-01&to=2025-01-02" \
  -H "Authorization: Bearer YOUR_API_TOKEN"
```

#### Example 2: In-App Events with Filters
```bash
curl -X GET \
  "https://hq1.appsflyer.com/api/raw-data/export/app/com.example.app/in_app_events_report/v5?from=2025-01-01&to=2025-01-02&event_name=af_purchase,af_subscribe&maximum_rows=500000" \
  -H "Authorization: Bearer YOUR_API_TOKEN"
```

#### Example 3: Organic Installs with Geo Filter
```bash
curl -X GET \
  "https://hq1.appsflyer.com/api/raw-data/export/app/com.example.app/organic_installs_report/v5?from=2025-01-01&to=2025-01-02&geo=US&currency=preferred" \
  -H "Authorization: Bearer YOUR_API_TOKEN"
```

#### Example 4: Hourly Split for High Volume
```bash
# Hour 1
curl -X GET \
  "https://hq1.appsflyer.com/api/raw-data/export/app/com.example.app/installs_report/v5?from=2025-01-01 00:00&to=2025-01-01 01:00&maximum_rows=1000000" \
  -H "Authorization: Bearer YOUR_API_TOKEN"

# Hour 2
curl -X GET \
  "https://hq1.appsflyer.com/api/raw-data/export/app/com.example.app/installs_report/v5?from=2025-01-01 01:00&to=2025-01-01 02:00&maximum_rows=1000000" \
  -H "Authorization: Bearer YOUR_API_TOKEN"
```

#### Example 5: Additional Fields Request
```bash
curl -X GET \
  "https://hq1.appsflyer.com/api/raw-data/export/app/com.example.app/installs_report/v5?from=2025-01-01&to=2025-01-02&additional_fields=device_category,keyword_id,cost_per_install" \
  -H "Authorization: Bearer YOUR_API_TOKEN"
```

### Response Format

**Content-Type:** `text/csv`

**Structure:**
- First row: CSV header with field names
- Subsequent rows: Data records
- Field separator: Comma (`,`)
- Text qualifier: Double quotes (`"`) when field contains comma, newline, or quote

**Example Response:**
```csv
appsflyer_id,event_time,event_name,install_time,media_source,campaign,country_code,platform,device_model,event_revenue,event_revenue_currency
1234567890-1234567,2025-01-01 10:30:45,af_purchase,2025-01-01 09:15:30,facebook,summer_campaign,US,android,SM-G991B,9.99,USD
1234567890-2345678,2025-01-01 11:45:22,af_purchase,2025-01-01 10:20:15,google,winter_sale,GB,ios,iPhone13,14.99,GBP
```

### Rate Limits

#### Raw Data Pull API Limits
- **Per report type:** Up to 24 requests per day per account per report type
- **Quota reset:** 00:00 UTC daily
- **Per report type independence:** Reaching limit for one report (e.g., installs_report) does not affect other reports (e.g., in_app_events_report)

#### Aggregate Pull API Limits
- **Date range ≤ 2 days:** Maximum 1 call per minute per app per report
- **Date range ≥ 3 days:** Maximum 120 calls per day per account; 24 calls per day per app

#### General API Rate Limit
- **Account-level limit:** 500 requests per second (30,000 per minute)
- **Applies to:** All AppsFlyer APIs combined

#### Best Practices for Rate Limiting
1. **Spread requests throughout the day** - Don't burst all 24 requests at once
2. **Use time-based splitting wisely** - Prefer larger time windows to minimize requests
3. **Monitor response headers** - Check for rate limit indicators
4. **Implement exponential backoff** - Retry with increasing delays on rate limit errors
5. **Cache responses** - Don't re-request the same data multiple times
6. **Separate quota tracking** - Track each report type's quota independently

#### Rate Limit Error Handling
When rate limit is exceeded, the API will return an error. Implement retry logic:
- Wait until quota reset (00:00 UTC for daily quotas)
- Use exponential backoff for transient errors
- Log rate limit errors for monitoring

### Comparing API Options

AppsFlyer offers multiple ways to access raw data:

| Feature | Pull API (this connector) | Push API | Data Locker |
|---------|---------------------------|----------|-------------|
| **Data retrieval** | On-demand via API | Real-time streaming | Cloud storage export |
| **Latency** | Minutes (real-time reports) | Seconds | Hours |
| **Rate limits** | 24 requests/day per report | No request limits | No request limits |
| **Data retention** | Based on plan | Real-time only | Long-term storage |
| **Incremental sync** | Date-based time windows | Event streaming | Batch files |
| **Best for** | Scheduled batch ingestion | Real-time pipelines | Data warehouse integration |
| **Cost** | API calls metered | Webhook infrastructure | Storage costs |

**Recommendation:** Use Pull API for scheduled batch ingestion (hourly, daily). Use Push API for real-time streaming requirements. Use Data Locker for data warehouse integration with long-term retention needs.

### Table-Specific Extra Parameters

Some report types require specific configurations:

#### In-App Events Reports
- **Optional:** `event_name` - Filter specific events to reduce data volume
- **Use case:** When only certain events are needed (purchases, subscriptions)

#### Retargeting Reports
- **Required:** `reattr=true` - Enable retargeting data
- **Use case:** All retargeting reports

#### Geo-Specific Reports
- **Optional:** `geo` - Filter by country code
- **Use case:** When building country-specific data sets
- **Limitation:** Only one country per request

#### Multi-App Scenarios
- Each `app_id` requires separate API requests
- Cannot query multiple apps in single request
- Recommendation: Implement parallel requests per app

## Field Type Mapping

AppsFlyer raw data uses specific data types that should be mapped to standard types for processing.

### Data Type Definitions

| AppsFlyer Type | Standard Type | PySpark Type | Description | Example |
|----------------|---------------|--------------|-------------|---------|
| String | String | StringType() | Text data, max 1024 characters | `"facebook"`, `"US"` |
| Date Time | Timestamp | TimestampType() | Format: `yyyy-mm-dd hh:mm:ss` | `"2025-01-05 10:30:45"` |
| Enum | String | StringType() | Predefined list of values | `"android"`, `"ios"` |
| Boolean | Boolean | BooleanType() | True/false values | `true`, `false` |
| Integer | Integer | LongType() | Whole numbers | `12345` |
| Characters | String | StringType() | Character sequence | `"ABC123"` |
| Timestamp | Long | LongType() | Unix timestamp in milliseconds | `1704452400000` |
| Dynamic Enum | String | StringType() | Enum with dynamically added values | `"youtube"`, `"instagram"` |

### Numeric Field Handling

**Revenue and Cost Fields (String Format):**
- Fields like `event_revenue`, `af_cost_value`, `af_net_revenue` are returned as **strings**
- Precision: Up to 4 decimal points
- Should be parsed as `Decimal` or `Double` for calculations
- Currency code provided in separate field (e.g., `event_revenue_currency`)

**Mapping:**
```python
# AppsFlyer: "9.99" (String)
# Should be: Decimal("9.99") or DoubleType()
```

### Date and Time Field Handling

**Format:** `yyyy-mm-dd hh:mm:ss` (e.g., `2025-01-05 10:30:45.898`)

**Key Time Fields:**
- `event_time` - Event occurrence timestamp (primary cursor)
- `install_time` - App installation timestamp
- `attributed_touch_time` - Attribution touch timestamp
- `click_time` - Click timestamp (for click reports)

**Timestamp Fields (Unix milliseconds):**
- `af_purchase_date_ms` - Purchase date in milliseconds
- `original_url_timestamp` - Original URL timestamp

### Identifier Field Handling

**Device Identifiers (may be null/empty):**
- `advertising_id` (GAID) - User-resettable, may be opt-out
- `idfa` - iOS identifier, may be empty due to ATT
- `idfv` - iOS vendor ID, persists per vendor
- `android_id` - Permanent Android ID
- `imei` - Device IMEI (rarely available)

**Persistent Identifier:**
- `appsflyer_id` - Always present, never null (primary key)

### Enum Field Values

**Platform:**
- `android`, `ios`, `windows_phone`, `roku`, `amazon`, `tvos`, `steam`, `oculus`, `kindle`

**Match Type (Attribution Method):**
- `id_matching` - Deterministic matching
- `probabilistic` - Probabilistic matching
- `srn` - Self-reporting network (e.g., Facebook, Google)
- `referrer` - Android referrer matching
- `deeplink` - Deep link attribution

**Event Type:**
- `install`, `re-engagement`, `re-attribution`, `in-app event`

### Null Value Handling

**Common Null Scenarios:**
1. **Organic reports** - Attribution fields (media_source, campaign, etc.) are null
2. **Privacy restrictions** - Device identifiers (IDFA, GAID) may be null
3. **Optional data** - Additional fields not populated for all events
4. **Platform-specific fields** - iOS fields null for Android, vice versa

**Recommendation:**
- All fields should be nullable in schema
- Use empty string for truly missing text values
- Use null for missing numeric/timestamp values

### Special Field Behaviors

**Auto-Generated Fields:**
- `appsflyer_id` - Generated by SDK on first app launch
- `install_time` - Captured on first app open
- `event_time` - Captured when event occurs

**Enumeration Extensions:**
- `af_channel` (Dynamic Enum) - New values added as new channels emerge
- `platform` - New platforms may be added

**Relationship Fields:**
- `app_id` - Links to app configuration
- `appsflyer_id` - Links user across events
- `media_source` - Links to media source configuration

### Field Validation and Constraints

**String Length:**
- Maximum: 1024 characters
- Longer values are truncated

**Date Ranges:**
- Historical data retention varies by subscription plan
- Real-time reports: Minutes of latency
- Daily reports: Updated at 00:00 UTC

**Required Fields:**
- `appsflyer_id` - Always present
- `event_time` - Always present
- `app_id` - Always present
- `platform` - Always present

### Type Conversion Example (Python)

```python
from pyspark.sql.types import *
from decimal import Decimal
from datetime import datetime

# String to Decimal (revenue fields)
event_revenue = Decimal(row['event_revenue']) if row['event_revenue'] else None

# String to Timestamp
event_time = datetime.strptime(row['event_time'], '%Y-%m-%d %H:%M:%S') if row['event_time'] else None

# String to Boolean
wifi = row['wifi'].lower() == 'true' if row['wifi'] else False

# String to Integer
impressions = int(row['impressions']) if row['impressions'] else None
```

### Recommended PySpark Schema Template

```python
from pyspark.sql.types import *

schema = StructType([
    # Core identifiers
    StructField("appsflyer_id", StringType(), False),
    StructField("event_time", TimestampType(), False),
    StructField("event_name", StringType(), True),

    # Attribution fields
    StructField("media_source", StringType(), True),
    StructField("campaign", StringType(), True),
    StructField("af_channel", StringType(), True),
    StructField("af_ad", StringType(), True),
    StructField("af_adset", StringType(), True),

    # Revenue fields (use DecimalType for precision or DoubleType for performance)
    StructField("event_revenue", DoubleType(), True),
    StructField("event_revenue_currency", StringType(), True),
    StructField("event_revenue_usd", DoubleType(), True),

    # Device fields
    StructField("platform", StringType(), False),
    StructField("device_model", StringType(), True),
    StructField("os_version", StringType(), True),
    StructField("advertising_id", StringType(), True),
    StructField("idfa", StringType(), True),

    # Location fields
    StructField("country_code", StringType(), True),
    StructField("city", StringType(), True),
    StructField("region", StringType(), True),

    # App fields
    StructField("app_id", StringType(), False),
    StructField("app_version", StringType(), True),
    StructField("bundle_id", StringType(), True),

    # Add more fields as needed...
])
```

## Sources and References

### Research Log

| Source Type | URL | Accessed (UTC) | Confidence | What it Confirmed |
|-------------|-----|----------------|------------|-------------------|
| Official Docs | https://support.appsflyer.com/hc/en-us/articles/360007530258-Pull-API-raw-data | 2025-01-05 | High | Authentication, report types, query parameters, pagination, incremental strategy |
| Official Docs | https://dev.appsflyer.com/hc/reference/raw_data_pull_api_tokenv2-overview | 2025-01-05 | High | Endpoint URLs, authentication headers, query parameters |
| Official Docs | https://support.appsflyer.com/hc/en-us/articles/208387843-Raw-data-field-dictionary | 2025-01-05 | High | Complete field schema, data types, field descriptions |
| Official Docs | https://support.appsflyer.com/hc/en-us/articles/209680773-Raw-data-reporting-overview | 2025-01-05 | High | Complete report type list, data freshness, report categories |
| Official Docs | https://support.appsflyer.com/hc/en-us/articles/207034366-Report-generation-quotas-rate-limitations | 2025-01-05 | High | Rate limits, quota specifications, best practices |
| Official Docs | https://dev.appsflyer.com/hc/reference/get_app-id-installs-report-v5 | 2025-01-05 | High | Installs endpoint specification |
| Official Docs | https://dev.appsflyer.com/hc/reference/get_app-id-in-app-events-report-v5 | 2025-01-05 | High | In-app events endpoint specification |
| Airbyte Implementation | https://docs.airbyte.com/integrations/sources/appsflyer | 2025-01-05 | High | Supported streams, incremental sync strategy, cursor fields |
| Airbyte GitHub | https://github.com/airbytehq/airbyte/tree/master/airbyte-integrations/connectors/source-appsflyer | 2025-01-05 | Medium | Connector structure, configuration parameters |
| Third-Party Docs | https://docs.hevodata.com/sources/mkt-analytics/appsflyer/ | 2025-01-05 | Medium | Table list, replication methods |

### Primary Sources (Highest Confidence)

1. **AppsFlyer Official Documentation** - All endpoint specifications, authentication, schemas, and rate limits are directly from official AppsFlyer Help Center and Developer Hub
2. **AppsFlyer API Reference** - Endpoint URLs, parameters, and response formats verified against official API reference
3. **AppsFlyer Field Dictionary** - Complete schema and field definitions from official raw data field dictionary

### Secondary Sources (High Confidence)

1. **Airbyte Open Source Implementation** - Validated stream names, cursor fields, and incremental sync patterns
2. **AppsFlyer Support Articles** - Confirmed best practices, limitations, and edge cases

### Tertiary Sources (Medium Confidence)

1. **Third-Party ETL Documentation** - Cross-referenced Hevo, Funnel, and Stitch documentation for additional validation
2. **Community Discussions** - Airbyte GitHub issues confirmed known schema mapping issues

### Source Prioritization

When conflicts arose, prioritization was:
1. **Official AppsFlyer Documentation** > All other sources
2. **AppsFlyer API Reference** > Third-party implementations
3. **Active Airbyte OSS** > Older implementations
4. **Recent documentation (2024-2025)** > Older docs

### Known Limitations

- **SKAdNetwork reports** - Not documented in detail (Data Locker exclusive)
- **Validation Rules reports** - Not available via Pull API (Data Locker exclusive)
- **Cross-Platform Engagements** - Data Locker exclusive
- **Schema evolution** - AppsFlyer may add new fields; use `additional_fields` parameter for new fields
- **Subscription-specific features** - Some reports require premium subscription tiers

### Confidence Assessment

- **Authentication:** High confidence - Verified across official docs and implementations
- **Endpoint URLs:** High confidence - Official API reference
- **Query parameters:** High confidence - Official docs with examples
- **Schemas:** High confidence - Official field dictionary
- **Rate limits:** High confidence - Official rate limit documentation
- **Primary keys:** High confidence - Official docs and Airbyte implementation
- **Incremental strategy:** High confidence - Official docs, Airbyte implementation, third-party docs
- **Data freshness:** High confidence - Official docs specify real-time vs. daily updates

### Updates and Maintenance

- AppsFlyer API is stable (v5 has been current for multiple years)
- Field dictionary is updated regularly by AppsFlyer
- Rate limits and quotas may change based on subscription plan
- New report types added occasionally (e.g., SKAdNetwork reports)
- Recommend reviewing official docs quarterly for updates
